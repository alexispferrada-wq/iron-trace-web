<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Iron Trace</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #4f46e5;
            --secondary: #64748b;
            --accent: #0ea5e9;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --text-dark: #1e293b;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--text-dark); }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }
        .user-info { display: flex; align-items: center; gap: 15px; font-weight: 600; }
        .logout-btn { color: var(--danger); text-decoration: none; border: 1px solid var(--danger); padding: 5px 15px; border-radius: 6px; transition: all 0.2s; }
        .logout-btn:hover { background: var(--danger); color: white; }

        /* GRID LAYOUT */
        .main-grid { display: grid; grid-template-columns: 2.5fr 1fr; gap: 25px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

        /* KPI CARDS */
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .stat-card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: 5px solid transparent; transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-card.blue { border-color: var(--primary); }
        .stat-card.orange { border-color: var(--warning); }
        .stat-value { font-size: 2rem; font-weight: 800; margin: 10px 0; color: var(--text-dark); }
        .stat-label { color: var(--secondary); text-transform: uppercase; font-size: 0.85rem; font-weight: 600; letter-spacing: 0.5px; }

        /* TABLAS Y LISTAS */
        .card { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 20px; }
        .card-header { padding: 15px 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .card-title { margin: 0; font-size: 1.1rem; color: var(--text-dark); font-weight: 700; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        th { background: #f8fafc; color: var(--secondary); padding: 12px 20px; text-align: left; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; }
        td { padding: 15px 20px; border-bottom: 1px solid #f1f5f9; }
        tr:last-child td { border-bottom: none; }
        
        /* ALERTAS STOCK */
        .alert-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; border-bottom: 1px solid #f1f5f9; }
        .alert-item:last-child { border-bottom: none; }
        .stock-badge { background: #fee2e2; color: #991b1b; padding: 4px 10px; border-radius: 99px; font-weight: 700; font-size: 0.85rem; }

        /* BOTONES ACCI√ìN */
        .action-grid { display: grid; gap: 15px; }
        .btn-action { display: block; padding: 15px; border-radius: 8px; text-align: center; text-decoration: none; font-weight: 700; transition: filter 0.2s; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-action:hover { filter: brightness(110%); }
        
        .bg-inventory { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .bg-reports { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .bg-users { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .bg-workers { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">üèóÔ∏è IRON TRACE <span style="font-weight:400; color:#94a3b8; font-size:0.8em;">PRO</span></div>
        <div class="user-info">
            <span>{{ session['user'] }} <small style="color:var(--secondary);">({{ rol | upper }})</small></span>
            <a href="/logout" class="logout-btn">Salir</a>
        </div>
    </header>

    <div class="stats-row">
        <div class="stat-card orange">
            <div class="stat-label">Consumo Insumos (Hoy)</div>
            <div class="stat-value">${{ "{:,.0f}".format(stats.insumos_hoy).replace(',','.') }}</div>
        </div>
        <div class="stat-card blue">
            <div class="stat-label">Herramientas en Faena</div>
            <div class="stat-value">{{ stats.prestamos_qty }}</div>
        </div>
    </div>

    <div class="main-grid">
        <div>
            {% if alertas %}
            <div class="card" style="border-top: 4px solid var(--danger);">
                <div class="card-header">
                    <h3 class="card-title" style="color: var(--danger);">‚ö† Alertas de Stock Bajo</h3>
                </div>
                <div>
                    {% for a in alertas %}
                    <div class="alert-item">
                        <div>
                            <strong>{{ a.nombre }}</strong><br>
                            <small style="color:var(--secondary)">ID: {{ a.id }}</small>
                        </div>
                        <span class="stock-badge">{{ a.stock }} unid.</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Herramientas Activas</h3>
                    <small style="color:var(--secondary)">√öltimos movimientos</small>
                </div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Trabajador</th>
                                <th>Herramienta</th>
                                <th>Fecha Salida</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in en_uso %}
                            <tr>
                                <td style="font-weight:600; color:var(--primary);">{{ p.worker_id }}</td>
                                <td>{{ p.nombre }} <span style="color:#94a3b8; font-size:0.85em;">({{ p.tool_id }})</span></td>
                                <td>{{ p.fecha_salida }}</td>
                            </tr>
                            {% else %}
                            <tr><td colspan="3" style="text-align:center; padding:30px; color:var(--secondary);">Todo devuelto en bodega ‚úÖ</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="action-grid">
            <div class="card" style="padding:20px;">
                <h3 class="card-title" style="margin-bottom:15px;">Accesos R√°pidos</h3>
                
                <a href="/inventario" class="btn-action bg-inventory">üì¶ Inventario y Compras</a>
                <a href="/reportes" class="btn-action bg-reports">üìÑ Reportes Hist√≥ricos</a>
                
                {% if rol in ['admin', 'supervisor'] %}
                    <a href="/trabajadores" class="btn-action bg-workers">üë∑ Base Trabajadores</a>
                {% endif %}
                
                {% if rol == 'admin' %}
                    <a href="/usuarios" class="btn-action bg-users">üë• Usuarios Sistema</a>
                    <a href="/admin/config" class="btn-action" style="background:#334155; margin-top:10px;">‚öôÔ∏è Configuraci√≥n</a>
                {% endif %}
            </div>
        </div>
    </div>

</body>
</html>
