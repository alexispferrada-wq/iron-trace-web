<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Configuraci√≥n - Iron Trace</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f9; padding: 40px; color: #333; }
        .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; max-width: 1100px; margin: 0 auto; }
        .card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 20px; }
        h3 { color: #34495e; margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        
        input[type="text"], input[type="file"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 15px; box-sizing: border-box; background: #fff; color: #000; font-size: 1rem; }
        label { font-weight: bold; font-size: 0.95em; display: block; margin-bottom: 5px; color: #2c3e50; }
        
        button { background: #27ae60; color: white; border: none; padding: 15px; width: 100%; font-weight: bold; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        button:hover { background: #219150; }
        
        .btn-upload { background: #3498db; }
        .btn-upload:hover { background: #2980b9; }

        /* PANEL SERVIDOR */
        .server-card { background: #2c3e50; color: white; }
        .server-table { width: 100%; font-family: monospace; font-size: 0.9em; }
        .server-table td { padding: 10px 0; border-bottom: 1px solid #444; }
        .server-table tr:last-child td { border-bottom: none; }
        .label-server { color: #bdc3c7; }
        .val-server { color: #2ecc71; font-weight: bold; text-align: right; } /* COLOR VISIBLE */
        
        .indicator { width: 10px; height: 10px; background: #2ecc71; border-radius: 50%; display: inline-block; margin-right: 8px; box-shadow: 0 0 5px #2ecc71; }
    </style>
</head>
<body>

    <a href="/dashboard" style="text-decoration:none; color:#555; display:block; max-width:1100px; margin:0 auto 10px auto;">‚¨Ö Volver al Dashboard</a>

    <div class="grid">
        <div>
            <div class="card">
                <h1>‚öôÔ∏è Configuraci√≥n Global</h1>
                
                {% with messages = get_flashed_messages() %}
                    {% if messages %}<div style="background:#d4edda; color:#155724; padding:10px; border-radius:4px; margin-bottom:20px;">{{ messages[0] }}</div>{% endif %}
                {% endwith %}

                <form method="POST">
                    <label>Nombre Empresa (Ticket)</label>
                    <input type="text" name="empresa_nombre" value="{{ config['empresa_nombre'] }}">

                    <label>Direcci√≥n Faena</label>
                    <input type="text" name="empresa_direccion" value="{{ config['empresa_direccion'] }}">

                    <label>Mensaje Pie de Ticket</label>
                    <input type="text" name="ticket_footer" value="{{ config['ticket_footer'] }}">

                    <label>ID Impresora (Red/Local)</label>
                    <input type="text" name="impresora_nombre" value="{{ config['impresora_nombre'] }}">

                    <button type="submit">GUARDAR CAMBIOS</button>
                </form>
            </div>

            <div class="card" style="border-top: 4px solid #3498db;">
                <h3>üì• Carga Masiva de Facturas (CSV)</h3>
                <p style="font-size:0.9em; color:#666; margin-bottom:15px;">
                    Suba un archivo CSV con el formato: <code>ID_PRODUCTO, CANTIDAD, PRECIO</code> (sin encabezados).
                </p>
                <form method="POST" enctype="multipart/form-data">
                    <label>N√∫mero Factura Global</label>
                    <input type="text" name="num_factura" placeholder="Ej: FAC-9999" required>
                    
                    <label>Archivo CSV</label>
                    <input type="file" name="archivo_csv" accept=".csv" required>
                    
                    <button type="submit" class="btn-upload">PROCESAR CARGA</button>
                </form>
            </div>
        </div>

        <div class="card server-card">
            <h3 style="color:white; border-color:#555;">üì° Estado del Servidor</h3>
            
            <div style="text-align:center; padding:20px 0; background:rgba(0,0,0,0.2); border-radius:4px; margin-bottom:20px;">
                <span class="indicator"></span> SISTEMA ONLINE
            </div>

            <table class="server-table">
                <tr><td class="label-server">Hora Servidor</td><td class="val-server" style="color:#f1c40f;">{{ server.time_server }}</td></tr>
                <tr><td class="label-server">Zona Horaria</td><td class="val-server">{{ server.timezone }}</td></tr>
                <tr><td class="label-server">Base de Datos</td><td class="val-server">{{ server.db_mode }}</td></tr>
                <tr><td class="label-server">Sistema OS</td><td class="val-server">{{ server.os }}</td></tr>
                <tr><td class="label-server">Nodo</td><td class="val-server">{{ server.node }}</td></tr>
                <tr><td class="label-server">CPUs</td><td class="val-server">{{ server.cpu }}</td></tr>
                <tr><td class="label-server">Runtime</td><td class="val-server">Python {{ server.python }}</td></tr>
            </table>
            
            <div style="margin-top:20px; font-size:0.7em; color:#777; word-break: break-all;">
                PATH: {{ server.app_path }}
            </div>
        </div>
    </div>

</body>
</html>
